{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 匹配标签名的  aa-xxx\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //  aa:aa-xxx\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); //  此正则可以匹配到标签名 匹配到结果的第一个(索引第一个) [1]\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>  [1]\r\nconst attribute =\r\n  /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\r\n\r\n// [1]属性的key   [3] || [4] ||[5] 属性的值  a=1  a='1'  a=\"\"\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的  />    >\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // {{   xxx  }}\r\n\r\nfunction parserHTML(html) {\r\n  // 不停的截取模板 直到把模板全部解析完毕\r\n\r\n  // 截取方法\r\n  function advance(len) {\r\n    html = html.substring(len);\r\n  }\r\n\r\n  // 解析开始标签\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen);\r\n    if (start) {\r\n      const match = {\r\n        tagName: start[1],\r\n        attrs: [],\r\n      };\r\n      advance(start[0].length);\r\n      let end;\r\n      let attr;\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        //1要有属性 2不能为开始的结束标签\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5],\r\n        });\r\n        advance(attr[0].length);\r\n      }\r\n      if (end) {\r\n        advance(end[0].length);\r\n      }\r\n      return match;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  while (html) {\r\n    //解析标签和文本\r\n    let index = html.indexOf(\"<\");\r\n    //标签\r\n    if (index == 0) {\r\n      //解析开始标签 并把属性也解析出来\r\n      const startTagMatch = parseStartTag();\r\n      if (startTagMatch) {\r\n        //开始标签\r\n        start(startTagMatch.tagName,startTagMatch.attrs);\r\n        continue;\r\n      }\r\n\r\n      \r\n      if (html.match(endTag)) {\r\n        //结束标签\r\n        continue;\r\n      }\r\n      break;\r\n    }\r\n\r\n    //文本\r\n  }\r\n}\r\n\r\nexport function compileToFunction(template) {\r\n  console.log(template);\r\n  //1 将模板变成ast语法树\r\n  let ast = parserHTML(template);\r\n}\r\n","export function isFunction(val) {\r\n  return typeof val == \"function\";\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val == \"object\" && val !== null;\r\n}\r\n\r\nexport let isArray = Array.isArray;\r\n","let oldArrayPrototype = Array.prototype;\r\n//让arrayMethods可以通过__proto__ 获取到数组的方法\r\nexport let arrayMethods = Object.create(oldArrayPrototype);\r\n\r\n//只有这7个方法可以导致数组发生变化\r\nlet methods = [\"push\", \"shift\", \"pop\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    console.log(\"数组的方法进行重写操作\");\r\n    //数组 新增的属性 要看一下是不是对象，如果是对象，继续进行劫持\r\n    oldArrayPrototype[method].call(this, ...args);\r\n\r\n    // 通过__ob__ 进行标识这个对象被监控过  （在vue中被监控的对象身上都有一个__ob__ 这个属性）\r\n\r\n    let inserted = null;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n        break;\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n    }\r\n    // 看一下新增的属性是不是对象， 看是否需要进行劫持\r\n    if (inserted) ob.observeArray(inserted);\r\n  };\r\n});\r\n","import { isArray, isObject } from \"../utils\";\r\nimport { arrayMethods } from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    //可以调用 __ob__ 是因为这里进行了设置\r\n    // 不让__ob__ 被遍历到\r\n    // value.__ob__ = this; // 我给对象和数组添加一个自定义属性\r\n    Object.defineProperty(value, \"__ob__\", {\r\n      value: this,\r\n      enumerable: false, // 标识这个属性不能被列举出来，不能被循环到\r\n    });\r\n\r\n    // 数组的情况  改写数组的原型链\r\n    if (isArray(value)) {\r\n      value.__proto__ = arrayMethods; //重写数组的方法\r\n      this.observeArray(value)\r\n    } else {\r\n      //对象的情况\r\n      // 核心就是循环对象\r\n      this.walk(value);\r\n    }\r\n  }\r\n\r\n  observeArray(data) {\r\n    //递归遍历数组 对数组内部的对象再次重写  [[]]  [{}]\r\n    data.forEach((item) => observe(item));\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\nfunction defineReactive(obj, key, value) {\r\n  // 递归进行观测数据\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      observe(newValue);\r\n      console.log(\"修改\");\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(value) {\r\n  // 如果不是对象就不用观测 写的有问题\r\n  if (!isObject(value)) {\r\n    return;\r\n  }\r\n\r\n  if(value.__ob__){\r\n      return //一个对象不需要重新被观测 \r\n  }\r\n\r\n  return new Observer(value);\r\n}\r\n","import { observe } from \"./observe\"; // rollup-plugin-node-resolve\r\nimport { isFunction } from \"./utils.js\";\r\n\r\nexport function initState(vm) {\r\n  // 把用户的选项传递过来\r\n  const opts = vm.$options;\r\n\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newValue) {\r\n      vm[source][key] = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n\r\n  // 这一步 把 data 也放在vm 上了\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n\r\n  //   需要将 data 变成响应式的\r\n  observe(data);\r\n\r\n  for(let key in data){\r\n    proxy(vm,key,'_data')\r\n  }\r\n\r\n  // console.log(data)\r\n  // data.arr.push(100);\r\n}\r\n","import { compileToFunction } from \"./compiler\";\r\nimport { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  // 在vue的原型上进行挂载\r\n  Vue.prototype._init = function (options) {\r\n    // 把用户的选项放到 vm 上，这样在其它方法中都可以获取到 options\r\n    const vm = this;\r\n    vm.$options = options;\r\n\r\n    // 传入数据 对数据进行操作\r\n    initState(vm);\r\n\r\n    if (vm.$options.el) {\r\n      vm.$mount(vm.$options.el);\r\n    }\r\n  };\r\n\r\n  //new Vue({el})  new Vue().$mount\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this;\r\n    const opts = vm.$options;\r\n    //获取真实元素\r\n    el = document.querySelector(el);\r\n    vm.$el = el; //页面真实元素\r\n\r\n    //此处对 三种挂载方式进行进行判断\r\n    if (!opts.render) {\r\n      //模板编译\r\n      let template = opts.template;\r\n      if (!template) {\r\n        template = el.outerHTML;\r\n      }\r\n      let render = compileToFunction(template);\r\n      opts.render = render;\r\n    }\r\n    // console.log(opts.render);\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  //这里调用原型上挂载的方法\r\n  this._init(options);\r\n}\r\n\r\n//只是把方法挂载到原型上去了 此处并没有执行\r\ninitMixin(Vue);\r\n\r\n// 导出Vue\r\nexport default Vue;\r\n"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parserHTML","html","advance","len","substring","parseStartTag","start","match","tagName","attrs","length","end","attr","push","name","value","index","indexOf","startTagMatch","compileToFunction","template","console","log","isFunction","val","isObject","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","slice","observeArray","Observer","constructor","defineProperty","enumerable","__proto__","walk","data","item","observe","keys","key","defineReactive","obj","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","initMixin","Vue","_init","options","el","$mount","document","querySelector","$el","render","outerHTML"],"mappings":"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"}