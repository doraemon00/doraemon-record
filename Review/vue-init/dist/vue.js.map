{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction(val) {\r\n  return typeof val == \"function\";\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val == \"object\" && val !== null;\r\n}\r\n\r\nexport let isArray = Array.isArray;\r\n","let oldArrayPrototype = Array.prototype;\r\n//让arrayMethods可以通过__proto__ 获取到数组的方法\r\nexport let arrayMethods = Object.create(oldArrayPrototype);\r\n\r\n//只有这7个方法可以导致数组发生变化\r\nlet methods = [\"push\", \"shift\", \"pop\", \"unshift\", \"reverse\", \"sort\", \"splice\"];\r\n\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    console.log(\"数组的方法进行重写操作\");\r\n    //数组 新增的属性 要看一下是不是对象，如果是对象，继续进行劫持\r\n    oldArrayPrototype[method].call(this, ...args);\r\n\r\n    // 通过__ob__ 进行标识这个对象被监控过  （在vue中被监控的对象身上都有一个__ob__ 这个属性）\r\n\r\n    let inserted = null;\r\n    let ob = this.__ob__;\r\n    switch (method) {\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n        break;\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n    }\r\n    // 看一下新增的属性是不是对象， 看是否需要进行劫持\r\n    if (inserted) ob.observeArray(inserted);\r\n  };\r\n});\r\n","import { isArray, isObject } from \"../utils\";\r\nimport { arrayMethods } from \"./array\";\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    //可以调用 __ob__ 是因为这里进行了设置\r\n    // 不让__ob__ 被遍历到\r\n    // value.__ob__ = this; // 我给对象和数组添加一个自定义属性\r\n    Object.defineProperty(value, \"__ob__\", {\r\n      value: this,\r\n      enumerable: false, // 标识这个属性不能被列举出来，不能被循环到\r\n    });\r\n\r\n    // 数组的情况  改写数组的原型链\r\n    if (isArray(value)) {\r\n      value.__proto__ = arrayMethods; //重写数组的方法\r\n    } else {\r\n      //对象的情况\r\n      // 核心就是循环对象\r\n      this.walk(value);\r\n    }\r\n  }\r\n\r\n  observeArray(data) {\r\n    //递归遍历数组\r\n    data.forEach((item) => observe(item));\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      defineReactive(data, key, data[key]);\r\n    });\r\n  }\r\n}\r\n\r\nfunction defineReactive(obj, key, value) {\r\n  // 递归进行观测数据\r\n  observe(value);\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return;\r\n      observe(newValue);\r\n      console.log(\"修改\");\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(value) {\r\n  // 如果不是对象就不用观测 写的有问题\r\n  if (!isObject(value)) {\r\n    return;\r\n  }\r\n\r\n  return new Observer(value);\r\n}\r\n","import { observe } from \"./observe\"; // rollup-plugin-node-resolve\r\nimport { isFunction } from \"./utils.js\";\r\n\r\nexport function initState(vm) {\r\n  // 把用户的选项传递过来\r\n  const opts = vm.$options;\r\n\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key];\r\n    },\r\n    set(newValue) {\r\n      vm[source][key] = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n\r\n  // 这一步 把 data 也放在vm 上了\r\n  data = vm._data = isFunction(data) ? data.call(vm) : data;\r\n\r\n  //   需要将 data 变成响应式的\r\n  observe(data);\r\n\r\n  for(let key in data){\r\n    proxy(vm,key,'_data')\r\n  }\r\n\r\n  // console.log(data)\r\n  // data.arr.push(100);\r\n}\r\n","import { initState } from './state'\r\n\r\nexport function initMixin(Vue) {\r\n  // 在vue的原型上进行挂载\r\n  Vue.prototype._init = function (options) {\r\n\r\n    // 把用户的选项放到 vm 上，这样在其它方法中都可以获取到 options \r\n    const vm = this;\r\n    vm.$options = options;\r\n\r\n\r\n    // 传入数据 对数据进行操作 \r\n    initState(vm)\r\n\r\n\r\n\r\n\r\n\r\n    // console.log(\"这是 init 方法\");\r\n    \r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  //这里调用原型上挂载的方法\r\n  this._init(options);\r\n}\r\n\r\n//只是把方法挂载到原型上去了 此处并没有执行\r\ninitMixin(Vue);\r\n\r\n// 导出Vue\r\nexport default Vue;\r\n"],"names":["isFunction","val","isObject","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","args","console","log","call","inserted","ob","__ob__","slice","observeArray","Observer","constructor","value","defineProperty","enumerable","__proto__","walk","data","item","observe","keys","key","defineReactive","obj","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","initMixin","Vue","_init","options"],"mappings":";;;;;;EAAO,SAASA,UAAT,CAAoBC,GAApB,EAAyB;EAC9B,SAAO,OAAOA,GAAP,IAAc,UAArB;EACD;EAEM,SAASC,QAAT,CAAkBD,GAAlB,EAAuB;EAC5B,SAAO,OAAOA,GAAP,IAAc,QAAd,IAA0BA,GAAG,KAAK,IAAzC;EACD;EAEM,IAAIE,OAAO,GAAGC,KAAK,CAACD,OAApB;;ECRP,IAAIE,iBAAiB,GAAGD,KAAK,CAACE,SAA9B;;EAEO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcJ,iBAAd,CAAnB;;EAGP,IAAIK,OAAO,GAAG,CAAC,MAAD,EAAS,OAAT,EAAkB,KAAlB,EAAyB,SAAzB,EAAoC,SAApC,EAA+C,MAA/C,EAAuD,QAAvD,CAAd;EAEAA,OAAO,CAACC,OAAR,CAAiBC,MAAD,IAAY;EAC1BL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,UAAU,GAAGC,IAAb,EAAmB;EACxCC,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EADwC;;EAGxCV,IAAAA,iBAAiB,CAACO,MAAD,CAAjB,CAA0BI,IAA1B,CAA+B,IAA/B,EAAqC,GAAGH,IAAxC,EAHwC;;EAOxC,QAAII,QAAQ,GAAG,IAAf;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQP,MAAR;EACE,WAAK,QAAL;EACEK,QAAAA,QAAQ,GAAGJ,IAAI,CAACO,KAAL,CAAW,CAAX,CAAX;EACA;;EACF,WAAK,MAAL;EACA,WAAK,SAAL;EACEH,QAAAA,QAAQ,GAAGJ,IAAX;EACA;EAPJ,KATwC;;;EAmBxC,QAAII,QAAJ,EAAcC,EAAE,CAACG,YAAH,CAAgBJ,QAAhB;EACf,GApBD;EAqBD,CAtBD;;ECJA,MAAMK,QAAN,CAAe;EACbC,EAAAA,WAAW,CAACC,KAAD,EAAQ;EACjB;EACA;EACA;EACAhB,IAAAA,MAAM,CAACiB,cAAP,CAAsBD,KAAtB,EAA6B,QAA7B,EAAuC;EACrCA,MAAAA,KAAK,EAAE,IAD8B;EAErCE,MAAAA,UAAU,EAAE,KAFyB;;EAAA,KAAvC,EAJiB;;EAUjB,QAAIvB,OAAO,CAACqB,KAAD,CAAX,EAAoB;EAClBA,MAAAA,KAAK,CAACG,SAAN,GAAkBpB,YAAlB,CADkB;EAEnB,KAFD,MAEO;EACL;EACA;EACA,WAAKqB,IAAL,CAAUJ,KAAV;EACD;EACF;;EAEDH,EAAAA,YAAY,CAACQ,IAAD,EAAO;EACjB;EACAA,IAAAA,IAAI,CAAClB,OAAL,CAAcmB,IAAD,IAAUC,OAAO,CAACD,IAAD,CAA9B;EACD;;EAEDF,EAAAA,IAAI,CAACC,IAAD,EAAO;EACTrB,IAAAA,MAAM,CAACwB,IAAP,CAAYH,IAAZ,EAAkBlB,OAAlB,CAA2BsB,GAAD,IAAS;EACjCC,MAAAA,cAAc,CAACL,IAAD,EAAOI,GAAP,EAAYJ,IAAI,CAACI,GAAD,CAAhB,CAAd;EACD,KAFD;EAGD;;EA7BY;;EAgCf,SAASC,cAAT,CAAwBC,GAAxB,EAA6BF,GAA7B,EAAkCT,KAAlC,EAAyC;EACvC;EACAO,EAAAA,OAAO,CAACP,KAAD,CAAP;EACAhB,EAAAA,MAAM,CAACiB,cAAP,CAAsBU,GAAtB,EAA2BF,GAA3B,EAAgC;EAC9BG,IAAAA,GAAG,GAAG;EACJ,aAAOZ,KAAP;EACD,KAH6B;;EAI9Ba,IAAAA,GAAG,CAACC,QAAD,EAAW;EACZ,UAAIA,QAAQ,KAAKd,KAAjB,EAAwB;EACxBO,MAAAA,OAAO,CAACO,QAAD,CAAP;EACAxB,MAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;EACAS,MAAAA,KAAK,GAAGc,QAAR;EACD;;EAT6B,GAAhC;EAWD;;EAEM,SAASP,OAAT,CAAiBP,KAAjB,EAAwB;EAC7B;EACA,MAAI,CAACtB,QAAQ,CAACsB,KAAD,CAAb,EAAsB;EACpB;EACD;;EAED,SAAO,IAAIF,QAAJ,CAAaE,KAAb,CAAP;EACD;;ECvDM,SAASe,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B;EACA,QAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB;;EAEA,MAAID,IAAI,CAACZ,IAAT,EAAe;EACbc,IAAAA,QAAQ,CAACH,EAAD,CAAR;EACD;EACF;;EAED,SAASI,KAAT,CAAeJ,EAAf,EAAmBP,GAAnB,EAAwBY,MAAxB,EAAgC;EAC9BrC,EAAAA,MAAM,CAACiB,cAAP,CAAsBe,EAAtB,EAA0BP,GAA1B,EAA+B;EAC7BG,IAAAA,GAAG,GAAG;EACJ,aAAOI,EAAE,CAACK,MAAD,CAAF,CAAWZ,GAAX,CAAP;EACD,KAH4B;;EAI7BI,IAAAA,GAAG,CAACC,QAAD,EAAW;EACZE,MAAAA,EAAE,CAACK,MAAD,CAAF,CAAWZ,GAAX,IAAkBK,QAAlB;EACD;;EAN4B,GAA/B;EAQD;;EAED,SAASK,QAAT,CAAkBH,EAAlB,EAAsB;EACpB,MAAIX,IAAI,GAAGW,EAAE,CAACE,QAAH,CAAYb,IAAvB,CADoB;;EAIpBA,EAAAA,IAAI,GAAGW,EAAE,CAACM,KAAH,GAAW9C,UAAU,CAAC6B,IAAD,CAAV,GAAmBA,IAAI,CAACb,IAAL,CAAUwB,EAAV,CAAnB,GAAmCX,IAArD,CAJoB;;EAOpBE,EAAAA,OAAO,CAACF,IAAD,CAAP;;EAEA,OAAI,IAAII,GAAR,IAAeJ,IAAf,EAAoB;EAClBe,IAAAA,KAAK,CAACJ,EAAD,EAAIP,GAAJ,EAAQ,OAAR,CAAL;EACD,GAXmB;EAcpB;;EACD;;ECpCM,SAASc,SAAT,CAAmBC,GAAnB,EAAwB;EAC7B;EACAA,EAAAA,GAAG,CAAC1C,SAAJ,CAAc2C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EAEvC;EACA,UAAMV,EAAE,GAAG,IAAX;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcQ,OAAd,CAJuC;;EAQvCX,IAAAA,SAAS,CAACC,EAAD,CAAT,CARuC;EAgBxC,GAhBD;EAiBD;;ECnBD,SAASQ,GAAT,CAAaE,OAAb,EAAsB;EACpB;EACA,OAAKD,KAAL,CAAWC,OAAX;EACD;;;EAGDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}